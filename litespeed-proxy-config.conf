# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# MEUMU ONLINE - CONFIGURAรรO LITESPEED PROXY REVERSO
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# 
# COMO USAR NO CYBERPANEL:
# 1. Acesse: https://meumu.com:8090 (CyberPanel)
# 2. Websites โ List Websites โ meumu.com โ Manage
# 3. vHost Conf (ou Configuration)
# 4. Cole o cรณdigo abaixo NO FINAL do arquivo
# 5. Save โ Graceful Restart LiteSpeed
# 
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# EXTERNAL APP (BACKEND NODE.JS)
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

extProcessor meumu-api {
  type                    proxy
  address                 127.0.0.1:3001
  maxConns                100
  env                     NODE_ENV=production
  initTimeout             60
  retryTimeout            0
  pcKeepAliveTimeout      60
  respBuffer              0
  autoStart               0
  notes                   MeuMU Online Backend API (Node.js)
}

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# CONTEXT - ROTA /api/ (PROXY PARA BACKEND)
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

context /api/ {
  type                    proxy
  handler                 meumu-api
  addDefaultCharset       off
  enableRewrite           1
  
  # Headers adicionais
  extraHeaders            <<<END_extraHeaders
Access-Control-Allow-Origin https://meumu.com
Access-Control-Allow-Methods GET, POST, PUT, DELETE, OPTIONS
Access-Control-Allow-Headers Authorization, Content-Type, X-Requested-With
Access-Control-Allow-Credentials true
  END_extraHeaders
}

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# CONTEXT - FRONTEND (SPA REACT)
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

context / {
  location                /home/meumu.com/public_html/dist
  allowBrowse             1
  indexFiles              index.html
  
  rewrite {
    enable                1
    autoLoadHtaccess      1
    
    # SPA - Todas as rotas โ index.html
    rules                 <<<END_rules
# React Router - SPA
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ /index.html [L,QSA]
    END_rules
  }
}

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# CACHE - ASSETS ESTรTICOS
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

context /assets/ {
  location                /home/meumu.com/public_html/dist/assets
  allowBrowse             1
  
  # Cache agressivo para assets buildados
  extraHeaders            <<<END_extraHeaders
Cache-Control public, max-age=31536000, immutable
  END_extraHeaders
}

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# SEGURANรA - BLOQUEAR ARQUIVOS SENSรVEIS
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

context ~ \.(env|log|sql|md|sh)$ {
  accessible              0
}

context ~ /\. {
  accessible              0
}

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# NOTAS IMPORTANTES
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
#
# ๐ VERIFICAR DEPOIS DE SALVAR:
# 
# 1. LiteSpeed reiniciou?
#    sudo systemctl status lsws
# 
# 2. Backend estรก rodando?
#    curl http://127.0.0.1:3001/health
# 
# 3. Proxy funcionando?
#    curl https://meumu.com/api/health
# 
# 4. Frontend carregando?
#    curl -I https://meumu.com
# 
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
